---
title: "항목02. 가상함수 테이블"
categories: 
    - Cpp
tags: [Cpp]

toc: true
toc_sticky: true

date: 2024-12-13
last_modified_at: 2024-12-13
---

# 가상함수 테이블

## 개념
🔲 C++에서 다형성을 구현하기 위해 사용하는 구조로 가상함수가 하나라도 존재하는 클래스에 대해 컴파일러가 내부적으로 생성해 사용한다.

## 생성
✅ 생성 시점 : 컴파일 타임  
✅ 생성 위치 : 데이터 영역  
✅ 생성 개수 : 클래스당 1개  

⚠️ 주의 : 상속관계라고 부모타입의 `v-table` 을 참조하지 않음

## 담는 정보
- 클래스에서 실제로 동작해야하는 함수의 주소를 가리킴  
- 일반적으로 RTTI정보에 대한 주소를 갖는다  
```
vtable(Base):
+--------------------+
| RTTI 정보 포인터    | -> type_info 객체
+--------------------+
| Base::func1 포인터 |
+--------------------+
| Base::func2 포인터 |
+--------------------+
```

# Vptr

## 개념
🔲 가상함수 테이블(vtable)을 참조하는데 사용되는 포인터

## 생성
✅ 생성 시점 : 런타임(객체 생성 시점)  
✅ 생성 위치 : 객체의 멤버  
✅ 생성 개수 : 객체당 1개  

## 초기화 시점
🔲 생성자 호출 시점에 vptr도 자동으로 초기화가 된다  
🔲 해당 클래스의 vtable을 가리키도록 설정된다.

⚠️ 주의 : 상속 관계에서 생성자 호출 순서에 따라 기본 클래스의 vtable -> 파생 클래스의 vtable로 `참조가 갱신`된다. 즉, **기본클래스 타입 생성자 호출 시점에서 vptr은 기본클래스의 vtable을 가리킨다**  

## 생성자 가상함수, 소멸자 가상함수 호출
🔲 위의 내용처럼 생성자에서 가상함수 호출 시 파생클래스의 override된 함수가 호출되지 않을 위험 존재  
🔲 소멸자의 경우 파괴된 파생클래스의 멤버데이터에 접근이나 변경을 시도하려고 할 수 있기에 피해야한다.